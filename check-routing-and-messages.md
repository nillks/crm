# Диагностика проблем роутинга и сообщений

## Проблемы:
1. Роутинг не работает (404 при перезагрузке)
2. Сообщения не приходят

## Решения:

### 1. Роутинг (HashRouter)
HashRouter установлен в `App.tsx`. После деплоя URL будут выглядеть так:
- `https://crm-frontend-8qrl.onrender.com/#/settings/ai`
- `https://crm-frontend-8qrl.onrender.com/#/clients`

**Важно:** HashRouter использует `#` в URL - это нормально и работает на всех хостингах.

### 2. Сообщения не приходят

**Проверьте:**

1. **Логи бэкенда:**
   ```bash
   render logs -r srv-d4bgm8n5r7bs7395netg --tail 50
   ```
   
   Ищите:
   - `✅ Incoming message processed` - сообщение получено
   - `⚠️ Ошибка при вызове AI` - ошибка в AI (не критично)
   - `Error processing incoming message` - критическая ошибка

2. **Webhook настройки:**
   - WhatsApp: проверьте, что webhook настроен в Green API
   - Telegram: проверьте, что бот запущен
   - Instagram: проверьте, что Chatrace webhook настроен

3. **AI настройки:**
   - Убедитесь, что AI включен для клиента в `/settings/ai`
   - Проверьте, что настройки сохранены

4. **База данных:**
   - Проверьте, что сообщения сохраняются в БД
   - Проверьте таблицу `messages` в PostgreSQL

### 3. Исправления применены:

✅ AI код теперь выполняется асинхронно (`setImmediate`) - не блокирует обработку сообщений
✅ Улучшена обработка ошибок AI
✅ HashRouter установлен

### 4. Если сообщения все еще не приходят:

1. Проверьте логи бэкенда на ошибки
2. Проверьте, что webhook'и настроены правильно
3. Проверьте, что сообщения доходят до обработчика (логи `✅ Incoming message processed`)
4. Если сообщения доходят, но не сохраняются - проверьте БД

### 5. Если роутинг все еще не работает:

HashRouter должен работать автоматически. Если нет:
1. Проверьте, что приложение собрано правильно
2. Проверьте, что `index.html` загружается
3. Проверьте консоль браузера на ошибки JavaScript

