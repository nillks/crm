# –§–∏–Ω–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Chatrace API –¥–ª—è Instagram

## ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ:

### 1. Chatrace –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç polling

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- –í—Å–µ GET endpoints –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç **401 "No valid API key provided"**
- –ü—Ä–æ–±–æ–≤–∞–Ω—ã —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
  - `Authorization: Bearer {token}`
  - `X-API-Key: {token}`
  - `api-key: {token}`
  - `token: {token}`
  - `access-token: {token}`
  - Query parameter `?token={token}`
- –ü—Ä–æ–±–æ–≤–∞–Ω—ã —Ä–∞–∑–Ω—ã–µ endpoints:
  - `/messages/receive`
  - `/messages/get`
  - `/instagram/messages`
  - `/api/messages`
  - `/webhook/receive`
  - `/v1/messages`
  - `/api/v1/instagram/messages`

**–í—ã–≤–æ–¥:** Chatrace **–ù–ï –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API –¥–ª—è polling** —Å–æ–æ–±—â–µ–Ω–∏–π. –°–æ–æ–±—â–µ–Ω–∏—è –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å **–¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ webhooks**.

### 2. Webhook –ù–ï –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ Chatrace

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- ‚úÖ Webhook endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç: `POST /instagram/webhook`
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook'–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- ‚ùå Webhook **–ù–ï –Ω–∞—Å—Ç—Ä–æ–µ–Ω** –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ Chatrace
- ‚ùå –°–æ–æ–±—â–µ–Ω–∏—è **–ù–ï –ø—Ä–∏—Ö–æ–¥—è—Ç**, –ø–æ—Ç–æ–º—É —á—Ç–æ Chatrace –Ω–µ –∑–Ω–∞–µ—Ç, –∫—É–¥–∞ –∏—Ö –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å

**–†–µ—à–µ–Ω–∏–µ:** **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å webhook –≤ Chatrace!

### 3. Chatrace –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç API

**–ü—Ä–æ–±–ª–µ–º–∞ —Å —Ç–æ–∫–µ–Ω–æ–º:**
- –¢–æ–∫–µ–Ω: `1543616.9NzKE301G8dmBBDxnJtACY1YXnDXFJ2HF`
- –§–æ—Ä–º–∞—Ç: `{accountId}.{token}`
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 401

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –¢–æ–∫–µ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è **–æ—Ç–ø—Ä–∞–≤–∫–∏** —Å–æ–æ–±—â–µ–Ω–∏–π, –∞ –Ω–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è
2. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –Ω—É–∂–µ–Ω **—Ç–æ–ª—å–∫–æ webhook**, –±–µ–∑ API –∫–ª—é—á–∞
3. –¢–æ–∫–µ–Ω –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (–Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫–µ)

## üîß –†–µ—à–µ–Ω–∏–µ

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Webhook –≤ Chatrace (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

**–≠—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è!**

1. **–í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç:**
   - https://chatrace.com/en/settings?acc=1543616
   - https://chatrace.com/e

2. **–ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª "Webhooks":**
   - Settings ‚Üí Webhooks
   - Settings ‚Üí API ‚Üí Webhooks
   - Settings ‚Üí Integrations ‚Üí Webhooks
   - Account Settings ‚Üí Webhook URL

3. **–î–æ–±–∞–≤—å—Ç–µ webhook URL:**
   
   **–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Å ngrok):**
   ```bash
   # –ó–∞–ø—É—Å—Ç–∏—Ç–µ ngrok
   ngrok http 3000
   
   # –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π URL
   https://abc123.ngrok.io/instagram/webhook
   ```
   
   **–î–ª—è production:**
   ```
   https://your-domain.com/instagram/webhook
   ```

4. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ webhook:**
   - ‚úÖ Webhook –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω** (enabled)
   - ‚úÖ –ú–µ—Ç–æ–¥: **POST**
   - ‚úÖ Content-Type: **application/json**
   - ‚úÖ –°–æ–±—ã—Ç–∏—è: **"Instagram messages"** –∏–ª–∏ **"Incoming messages"**

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É webhook

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook –≤ Chatrace:

1. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Instagram**
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞** - –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
   ```
   üì® Received webhook from Instagram/Chatrace
   üì¶ Full body: { ... }
   üîÑ Processing Chatrace webhook: { ... }
   ‚úÖ Chatrace Instagram message processed: ...
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:**
   ```bash
   curl -X GET http://localhost:3000/instagram/stats \
     -H "Authorization: Bearer YOUR_TOKEN"
   ```

### –®–∞–≥ 3: –ï—Å–ª–∏ webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞:**
   - –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok
   - –î–ª—è production –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–æ–º–µ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞:**
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ webhook

3. **–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É Chatrace:**
   - –£—Ç–æ—á–Ω–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç webhook'–æ–≤
   - –£—Ç–æ—á–Ω–∏—Ç–µ, –∫–∞–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å
   - –£—Ç–æ—á–Ω–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------|--------|------------|
| Webhook endpoint | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | `/instagram/webhook` |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook'–æ–≤ | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ |
| Polling | ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç | Chatrace –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç |
| Webhook –≤ Chatrace | ‚ùå –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω | **–ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å!** |
| –°–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç | ‚ùå –ù–µ—Ç | –ü–æ—Ç–æ–º—É —á—Ç–æ webhook –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω |

## üéØ –ì–ª–∞–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

**Webhook –ù–ï –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ Chatrace!**

–ë–µ–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ webhook'–∞ Chatrace –Ω–µ –∑–Ω–∞–µ—Ç, –∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è, –ø–æ—ç—Ç–æ–º—É –æ–Ω–∏ –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä.

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –≤ Chatrace** (–≥–ª–∞–≤–Ω–æ–µ!)
2. ‚úÖ –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Instagram
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —á–µ—Ä–µ–∑ `/instagram/stats`

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –Ω–∞—á–∞—Ç—å –ø—Ä–∏—Ö–æ–¥–∏—Ç—å!

