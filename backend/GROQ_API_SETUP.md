# Настройка Groq API для AI-агента

## Что такое Groq?

Groq - это бесплатная платформа для доступа к AI моделям, включая Llama 3.1, которая отлично поддерживает русский язык. В нашем CRM используется Groq вместо платных ChatGPT и YandexGPT.

## Получение API ключа

1. Перейдите на https://console.groq.com/
2. Зарегистрируйтесь или войдите в аккаунт
3. Перейдите в раздел "API Keys" (https://console.groq.com/keys)
4. Нажмите "Create API Key"
5. Скопируйте созданный ключ

## Настройка в проекте

1. Установите пакет (если еще не установлен):
```bash
cd backend
npm install groq-sdk
```

2. Добавьте переменную окружения в `.env` файл в корне `backend/`:

```env
GROQ_API_KEY=your_groq_api_key_here
```

**Важно:** 
- Ключ должен начинаться с `gsk_`
- Не должно быть пробелов вокруг знака `=`
- Файл `.env` должен быть в директории `backend/`

## Используемые модели

По умолчанию используется модель `llama-3.1-8b-instant`, которая:
- Быстро отвечает
- Хорошо поддерживает русский язык
- Бесплатна для использования

Альтернативные модели (можно настроить в `ai_settings`):
- `llama-3.1-8b-instant` (по умолчанию) - быстрая, хороший русский
- `mixtral-8x7b-32768` - более мощная, отличный русский
- `llama-3.1-70b-versatile` - самая мощная, но медленнее

## Endpoints

### ChatGPT (на самом деле Groq)
```
POST /api/ai/chatgpt/generate
Body: {
  "message": "Ваш вопрос",
  "clientId": "uuid (опционально)",
  "systemPrompt": "опционально",
  "temperature": 0.7 (опционально),
  "maxTokens": 1000 (опционально)
}
```

### Yandex GPT (на самом деле Groq)
```
POST /api/ai/yandex-gpt/generate
Body: {
  "message": "Ваш вопрос",
  "clientId": "uuid (опционально)",
  "systemPrompt": "опционально",
  "temperature": 0.7 (опционально),
  "maxTokens": 1000 (опционально)
}
```

### Статистика
```
GET /api/ai/stats?clientId=uuid (опционально)
```

### Логи
```
GET /api/ai/logs?clientId=uuid&userId=uuid&provider=openai&limit=10&offset=0
```

## Mock режим

Если `GROQ_API_KEY` не установлен, AI будет работать в mock режиме, возвращая тестовые ответы. Это полезно для разработки без API ключа.

## Лимиты Groq

Groq предоставляет бесплатный tier с лимитами:
- До 30 запросов в минуту
- До 14,400 запросов в день

Эти лимиты обычно достаточны для большинства CRM задач.

